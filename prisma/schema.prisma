generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Ingredient {
  id                String   @id @default(uuid()) @db.Uuid
  name              String   @unique
  caloriesPer100g   Decimal  @db.Decimal(8, 2) @map("calories")
  proteinPer100g    Decimal  @db.Decimal(8, 2) @map("protein")
  carbsPer100g      Decimal  @db.Decimal(8, 2) @map("carbs")
  fatPer100g        Decimal  @db.Decimal(8, 2) @map("fat")
  category          String?
  isCustom          Boolean  @default(true) @map("is_custom")
  createdAt         DateTime @default(now()) @map("created_at")
  
  recipeIngredients RecipeIngredient[]
  
  @@index([name])
  @@index([category])
  @@map("ingredients")
}

model Recipe {
  id            String   @id @default(uuid()) @db.Uuid
  name          String
  description   String?
  instructions  String?
  servings      Int      @default(1)
  imageUrl      String?
  createdAt     DateTime @default(now()) @map("created_at")
  
  ingredients     RecipeIngredient[]
  cookingHistory  CookingHistory[]
  
  @@index([name])
  @@map("recipes")
}

model RecipeIngredient {
  id             String   @id @default(uuid()) @db.Uuid
  recipeId       String   @db.Uuid
  ingredientId   String   @db.Uuid
  quantityGrams  Decimal  @db.Decimal(8, 2) @map("quantity_grams")
  
  recipe       Recipe     @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Cascade)
  
  @@unique([recipeId, ingredientId])
  @@index([ingredientId])
  @@map("recipe_ingredients")
}

model CookingHistory {
  id         String   @id @default(uuid()) @db.Uuid
  recipeId   String   @db.Uuid @map("recipe_id")
  cookedAt   DateTime @default(now()) @map("cooked_at")
  rating     Int?     @db.SmallInt
  favorite   Boolean? @map("favorite")
  notes      String?
  createdAt  DateTime @default(now()) @map("created_at")
  
  recipe Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  
  @@index([cookedAt])
  @@index([recipeId, cookedAt])
  @@map("cooking_history")
}